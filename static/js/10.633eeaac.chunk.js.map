{"version":3,"sources":["components/charts/simplePieChart.tsx","components/playerDetails/charts/winLoseDistribution.tsx"],"names":["DEFAULT_COLORS","RADIAN","Math","PI","renderCustomizedLabelFactory","lineHeight","innerLabelFontSize","props","value","lines","toString","trim","split","viewBox","cx","cy","outerRadius","startAngle","radius","angle","x","cos","y","sin","polarToCartesian","endAngle","sign","min","abs","getDeltaAngle","yStart","length","map","text","index","stroke","strokeWidth","fill","fontSize","textAnchor","dominantBaseline","defaultInnerLabel","item","innerLabel","defaultOuterLabel","outerLabel","SimplePieChart","items","outerLabelOffset","innerLabelLineHeight","colors","aspect","cells","useMemo","Array","_","fillOpacity","renderCustomizedLabel","wrappedOuterLabel","ret","offsetRadius","width","height","isAnimationActive","data","nameKey","dataKey","label","valueAccessor","undefined","position","content","buildItems","stats","keys","labels","total","sum","key","formatPercent","filter","WinLoseDistribution","t","useTranslation","winData","loseData","loseSelfData","result","selfOther","放铳时副露率","放铳时立直率","push","className"],"mappings":"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","file":"static/js/10.633eeaac.chunk.js","sourcesContent":["import React from \"react\";\nimport {\n  ResponsiveContainer,\n  PieChart,\n  Pie,\n  Cell,\n  LabelList,\n  LabelProps,\n  PolarViewBox,\n} from \"recharts\";\nimport { useMemo } from \"react\";\n\nconst DEFAULT_COLORS = [\"#003f5c\", \"#7a5195\", \"#ef5675\", \"#ffa600\"];\n\nconst getDeltaAngle = (startAngle: number, endAngle: number) => {\n  const sign = Math.sign(endAngle - startAngle);\n  const deltaAngle = Math.min(Math.abs(endAngle - startAngle), 360);\n\n  return sign * deltaAngle;\n};\n\nconst RADIAN = Math.PI / 180;\n\nconst polarToCartesian = (cx: number, cy: number, radius: number, angle: number) => ({\n  x: cx + Math.cos(-RADIAN * angle) * radius,\n  y: cy + Math.sin(-RADIAN * angle) * radius,\n});\n\nconst renderCustomizedLabelFactory = ({ lineHeight = 24, innerLabelFontSize = \"1rem\" }) => (props: LabelProps) => {\n  const { value } = props;\n  if (!value) {\n    return null;\n  }\n  const lines = value.toString().trim().split(\"\\n\");\n  const { cx, cy, outerRadius, startAngle, endAngle } = props.viewBox as Required<PolarViewBox>;\n  const labelAngle = startAngle + getDeltaAngle(startAngle, endAngle) / 2;\n  const { x, y } = polarToCartesian(cx, cy, outerRadius / 2, labelAngle);\n  const yStart = y - (lines.length - 1) * (lineHeight / 2);\n  return (\n    <g>\n      {lines.map((text, index) => (\n        <text\n          key={index}\n          x={x}\n          y={yStart + index * lineHeight}\n          stroke=\"#fff\"\n          strokeWidth=\"0.5\"\n          fill=\"#fff\"\n          fontSize={innerLabelFontSize}\n          textAnchor=\"middle\"\n          dominantBaseline=\"central\"\n        >\n          {text}\n        </text>\n      ))}\n    </g>\n  );\n};\n\nexport type PieChartItem = {\n  value: number;\n  innerLabel?: string;\n  outerLabel?: string;\n};\n\nfunction defaultInnerLabel<T extends PieChartItem>(item: T) {\n  return item.innerLabel || \"\";\n}\nfunction defaultOuterLabel<T extends PieChartItem>(item: T) {\n  return item.outerLabel || \"\";\n}\n\nexport default function SimplePieChart<T extends PieChartItem>({\n  items,\n  innerLabel = defaultInnerLabel,\n  outerLabel = defaultOuterLabel,\n  outerLabelOffset = 0,\n  innerLabelLineHeight = 24,\n  startAngle = 0,\n  colors = DEFAULT_COLORS,\n  innerLabelFontSize = \"1rem\",\n  aspect = 1,\n}: {\n  items: T[];\n  innerLabel?: (item: T) => string;\n  outerLabel?: (item: T) => string;\n  outerLabelOffset?: number;\n  innerLabelLineHeight?: number;\n  startAngle?: number;\n  colors?: string[];\n  innerLabelFontSize?: string;\n  aspect?: number;\n}) {\n  const cells = useMemo(\n    () =>\n      Array(items.length)\n        .fill(0)\n        .map((_, index) => <Cell fill={colors[index % colors.length]} fillOpacity={1} key={`cell-${index}`} />),\n    [items.length, colors]\n  );\n  const renderCustomizedLabel = useMemo(\n    () => renderCustomizedLabelFactory({ lineHeight: innerLabelLineHeight, innerLabelFontSize }),\n    [innerLabelLineHeight, innerLabelFontSize]\n  );\n  const wrappedOuterLabel = useMemo(() => {\n    const ret = (item: T) => outerLabel(item);\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (ret as any).offsetRadius = outerLabelOffset;\n    return ret;\n  }, [outerLabel, outerLabelOffset]);\n  return (\n    <ResponsiveContainer width=\"100%\" aspect={aspect} height=\"auto\">\n      <PieChart>\n        <Pie\n          isAnimationActive={false}\n          data={items}\n          nameKey=\"outerLabel\"\n          dataKey=\"value\"\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          label={wrappedOuterLabel as (x: any) => string}\n          startAngle={startAngle}\n          endAngle={startAngle + 360}\n        >\n          {cells}\n          <LabelList\n            valueAccessor={innerLabel}\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            dataKey={undefined as any}\n            position=\"inside\"\n            content={renderCustomizedLabel}\n            {...{ fill: \"#fff\" }}\n          />\n        </Pie>\n      </PieChart>\n    </ResponsiveContainer>\n  );\n}\n","import React from \"react\";\nimport { PlayerExtendedStats, PlayerMetadata } from \"../../../data/types\";\nimport SimplePieChart, { PieChartItem } from \"../../charts/simplePieChart\";\nimport { sum } from \"../../../utils\";\nimport { formatPercent } from \"../../../utils/index\";\nimport { useMemo } from \"react\";\nimport { useTranslation } from \"react-i18next\";\n\nfunction buildItems(\n  stats: PlayerExtendedStats,\n  keys: (keyof PlayerExtendedStats)[],\n  labels: string[],\n  total = 0\n): PieChartItem[] {\n  total = total || sum(keys.map((key) => (stats[key] as number) || 0));\n  return keys\n    .map((key, index) => ({\n      value: stats[key] as number,\n      outerLabel: labels[index],\n      innerLabel: formatPercent((stats[key] as number) / total),\n    }))\n    .filter((item) => item.value);\n}\n\nexport default function WinLoseDistribution({ stats }: { stats: PlayerExtendedStats; metadata: PlayerMetadata }) {\n  const { t } = useTranslation();\n  const winData = useMemo(() => buildItems(stats, [\"立直和了\", \"副露和了\", \"默听和了\"], [\"立直\", \"副露\", \"默听\"]), [\n    stats,\n  ]);\n  const loseData = useMemo(\n    () => buildItems(stats, [\"放铳至立直\", \"放铳至副露\", \"放铳至默听\"], [\"立直\", \"副露\", \"默听\"]),\n    [stats]\n  );\n  const loseSelfData = useMemo(() => {\n    const result = buildItems(stats, [\"放铳时立直率\", \"放铳时副露率\"], [\"立直\", \"副露\"], 1);\n    const selfOther = {\n      value: 1 - (stats.放铳时副露率 || 0) - (stats.放铳时立直率 || 0),\n      outerLabel: \"门清\",\n    } as PieChartItem;\n    if (selfOther.value > 0.00001) {\n      selfOther.innerLabel = formatPercent(selfOther.value / 1);\n      result.push(selfOther);\n    }\n    return result.filter((item) => item.value);\n  }, [stats]);\n  return (\n    <div className=\"row\">\n      <div className=\"col-lg-4 mb-2\">\n        <h5 className=\"text-center\">{t(\"和牌时\")}</h5>\n        <SimplePieChart\n          aspect={4 / 3}\n          items={winData}\n          startAngle={-45}\n          innerLabelFontSize=\"0.85rem\"\n          outerLabelOffset={10}\n          outerLabel={(x) => t(x.outerLabel || \"\")}\n        />\n      </div>\n      <div className=\"col-lg-4 mb-2\">\n        <h5 className=\"text-center\">{t(\"放铳时\")}</h5>\n        <SimplePieChart\n          aspect={4 / 3}\n          items={loseSelfData}\n          startAngle={-45}\n          innerLabelFontSize=\"0.85rem\"\n          outerLabelOffset={10}\n          outerLabel={(x) => t(x.outerLabel || \"\")}\n        />\n      </div>\n      <div className=\"col-lg-4 mb-2\">\n        <h5 className=\"text-center\">{t(\"放铳至\")}</h5>\n        <SimplePieChart\n          aspect={4 / 3}\n          items={loseData}\n          startAngle={-45}\n          innerLabelFontSize=\"0.85rem\"\n          outerLabelOffset={10}\n          outerLabel={(x) => t(x.outerLabel || \"\")}\n        />\n      </div>\n    </div>\n  );\n}\n"],"sourceRoot":""}